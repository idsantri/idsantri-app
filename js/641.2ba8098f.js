"use strict";(globalThis["webpackChunkidsantri_app"]=globalThis["webpackChunkidsantri_app"]||[]).push([[641],{20641:(a,e,l)=>{l.r(e),l.d(e,{default:()=>R});var t=l(51347),n=l(8633),s=l(37763),o=l(21734),i=l(68158),r=l(90575),u=l(15469),d=l(34187),c=l(16138);const p=(0,t.Lk)("div",{tag:"h1",class:"text-subtitle1"},"Upload Nilai",-1),m=(0,t.Lk)("span",{class:"text-green text-italic"}," Hanya membaca sheet pertama ",-1),b={class:"row"},k={class:"col-sm-6 col-xs-12"},v={class:"col-sm-6 col-xs-12"},g=(0,t.Lk)("ul",null,[(0,t.Lk)("li",null,"Kelas ID"),(0,t.Lk)("li",null,"Mapel ID"),(0,t.Lk)("li",null,"Kategori Nilai"),(0,t.Lk)("li",null,"Ujian Ke-?")],-1),_=(0,t.Lk)("br",null,null,-1),h={__name:"UploadPage",setup(a){const e=(0,d.KR)({category:"ujian"}),l=(0,d.KR)(),h=(0,d.KR)([]),f=(0,d.KR)([]),q=(0,d.KR)([{}]),F=(0,d.KR)(1),{loadingMain:w}=(0,d.QW)((0,r.A)());(0,t.sV)((async()=>{const a=await(0,o.A)({endPoint:"mapel",loading:w});q.value=a.mapel;const e=a.mapel.map((a=>a.id));f.value=e}));const y=a=>{const e=a.target.files[0],l=new FileReader;l.onload=a=>{const e=a.target.result,l=(0,c.LF)(e,{type:"array"}),t=l.SheetNames[0],n=l.Sheets[t],s=c.Wp.sheet_to_json(n,{defval:null});x(s,f.value)?(h.value=s,F.value=2):((0,u.KQ)("Data tidak dapat diproses"),(0,u.KQ)("Pastikan baris pertama adalah judul kolom dan baris berikutnya adalah konten data"))},l.readAsArrayBuffer(e)};function x(a,e){return e.some((e=>a[0].hasOwnProperty(e)))&&a[0].hasOwnProperty("kelas_id")}function A({nilaiPivot:a,mapelIds:e,category:l,ujian_ke:t}){let n=[];return e.forEach((e=>{if(a[0].hasOwnProperty(e)){const s=a.map((a=>({kelas_id:a.kelas_id,mapel_id:e,ujian_ke:parseInt(t),["n_"+l]:a[e]||null})));n=n.concat(s)}})),n}async function L(){const a=A({nilaiPivot:h.value,mapelIds:f.value,category:e.value.category,ujian_ke:e.value.ujian_ke}),l=await(0,i.A)({endPoint:"nilai-mapel",data:{data:a},loading:w});l&&(F.value=1)}return(0,t.wB)(l,(a=>{a||(h.value=[])})),(0,t.wB)(F,(a=>{1!=a&&(h.value.length||(F.value=1))})),(a,o)=>{const i=(0,t.g2)("q-space"),r=(0,t.g2)("q-btn"),u=(0,t.g2)("q-card-section"),d=(0,t.g2)("q-separator"),c=(0,t.g2)("q-icon"),f=(0,t.g2)("q-file"),w=(0,t.g2)("q-step"),x=(0,t.g2)("q-th"),A=(0,t.g2)("q-tr"),Q=(0,t.g2)("q-table"),K=(0,t.g2)("q-select"),C=(0,t.g2)("q-input"),j=(0,t.g2)("q-form"),P=(0,t.g2)("q-card"),V=(0,t.g2)("q-stepper"),S=(0,t.g2)("q-page");return(0,t.uX)(),(0,t.Wv)(S,{class:"q-pa-sm"},{default:(0,t.k6)((()=>[(0,t.bF)(P,null,{default:(0,t.k6)((()=>[(0,t.bF)(u,{class:"q-pa-sm bg-green-8 text-green-11 flex"},{default:(0,t.k6)((()=>[p,(0,t.bF)(i),(0,t.bF)(r,{label:"Kembali",to:"/madrasah/nilai-mapel",dense:"",outline:"","no-caps":"",icon:"arrow_back",class:"q-px-sm q-mr-md"}),(0,t.bF)(r,{label:"Download",to:"/madrasah/nilai-mapel/download",dense:"",outline:"","no-caps":"",icon:"download",class:"q-px-sm"})])),_:1}),(0,t.bF)(u,{class:"no-padding"},{default:(0,t.k6)((()=>[(0,t.bF)(V,{modelValue:F.value,"onUpdate:modelValue":o[5]||(o[5]=a=>F.value=a),ref:"stepper","done-color":"green-8","active-color":"green-10",animated:"",flat:"","header-nav":""},{default:(0,t.k6)((()=>[(0,t.bF)(w,{name:1,title:"Pilih File",caption:"*.xls, *.xlsx",icon:"create_new_folder",done:F.value>1},{default:(0,t.k6)((()=>[(0,t.bF)(d,{class:"q-mb-md"}),(0,t.bF)(f,{onInput:y,outlined:"","bottom-slots":"",modelValue:l.value,"onUpdate:modelValue":o[2]||(o[2]=a=>l.value=a),label:"Pilih file excel",counter:"",dense:"",style:{"max-width":"500px"}},{prepend:(0,t.k6)((()=>[(0,t.bF)(c,{name:"cloud_upload",onClick:o[0]||(o[0]=(0,n.D$)((()=>{}),["stop","prevent"]))})])),after:(0,t.k6)((()=>[(0,t.bF)(c,{name:"close",onClick:o[1]||(o[1]=(0,n.D$)((a=>l.value=null),["stop","prevent"])),class:"cursor-pointer"})])),hint:(0,t.k6)((()=>[m])),_:1},8,["modelValue"])])),_:1},8,["done"]),(0,t.bF)(w,{name:2,title:"Cek Data",caption:"Konfirmasi",icon:"assignment_turned_in",done:F.value>2},{default:(0,t.k6)((()=>[(0,t.bF)(d,{class:"q-mb-md"}),(0,t.bF)(Q,{rows:h.value,flat:"",bordered:"",class:"","rows-per-page-options":[10,25,50,75,100,0]},{header:(0,t.k6)((a=>[(0,t.bF)(A,{props:a},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(a.cols,(e=>((0,t.uX)(),(0,t.Wv)(x,{key:e.name,props:a,class:"text-bold",title:q.value.find((a=>a.id.toLowerCase()==e.label.toLowerCase()))?.mapel||""},{default:(0,t.k6)((()=>[(0,t.eW)((0,s.v_)(e.label.toLowerCase())+" ",1),q.value.find((a=>a.id.toLowerCase()==e.label.toLowerCase()))||"kelas_id"==e.label.toLowerCase()?((0,t.uX)(),(0,t.Wv)(c,{key:0,name:"check_circle",color:"green",size:"1.3em"})):(0,t.Q3)("",!0)])),_:2},1032,["props","title"])))),128))])),_:2},1032,["props"])])),_:1},8,["rows"])])),_:1},8,["done"]),(0,t.bF)(w,{name:3,title:"Lengkapi Data",caption:"Langkah Terakhir",icon:"article"},{default:(0,t.k6)((()=>[(0,t.bF)(d,{class:"q-mb-md"}),(0,t.Lk)("div",b,[(0,t.Lk)("div",k,[(0,t.bF)(P,{bordered:"",flat:"",class:"q-ma-xs"},{default:(0,t.k6)((()=>[(0,t.bF)(u,null,{default:(0,t.k6)((()=>[(0,t.bF)(j,{style:{"max-width":"500px"},onSubmit:(0,n.D$)(L,["prevent"])},{default:(0,t.k6)((()=>[(0,t.bF)(K,{dense:"",class:"q-mt-sm",outlined:"",label:"Kategori Nilai",modelValue:e.value.category,"onUpdate:modelValue":o[3]||(o[3]=a=>e.value.category=a),required:"",hint:"Kesalahan karena hal ini berakibat fatal",options:[{value:"ujian",label:"Nilai Ujian"},{value:"harian",label:"Nilai Harian"}],"emit-value":"","map-options":""},null,8,["modelValue"]),(0,t.bF)(C,{dense:"",class:"q-mt-sm",outlined:"",label:"Ujian Ke",modelValue:e.value.ujian_ke,"onUpdate:modelValue":o[4]||(o[4]=a=>e.value.ujian_ke=a),required:"",type:"number",hint:"Kesalahan karena hal ini berakibat fatal",rules:[a=>a>0&&a<5||"antara 1 s.d. 4"]},null,8,["modelValue","rules"]),(0,t.bF)(r,{type:"submit",label:"Simpan",icon:"save",dense:"",class:"q-mt-sm q-px-sm","no-caps":""})])),_:1})])),_:1})])),_:1})]),(0,t.Lk)("div",v,[(0,t.bF)(P,{flat:"",bordered:"",class:"q-ma-xs"},{default:(0,t.k6)((()=>[(0,t.bF)(u,{class:""},{default:(0,t.k6)((()=>[(0,t.eW)(" Pastikan data berikut sudah benar: "),g,_,(0,t.eW)(" Kesalahan karena hal ini akan susah diperbaiki. ")])),_:1})])),_:1})])])])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1})}}};var f=l(75013),q=l(83341),F=l(60222),w=l(5873),y=l(22677),x=l(94527),A=l(5226),L=l(86915),Q=l(85621),K=l(93933),C=l(27010),j=l(87339),P=l(22517),V=l(53417),S=l(76941),D=l(46395),I=l(272),U=l.n(I);const W=h,R=W;U()(h,"components",{QPage:f.A,QCard:q.A,QCardSection:F.A,QSpace:w.A,QBtn:y.A,QStepper:x.A,QStep:A.A,QSeparator:L.A,QFile:Q.A,QIcon:K.A,QTable:C.A,QTr:j.A,QTh:P.A,QForm:V.A,QSelect:S.A,QInput:D.A})}}]);